$.fn.getSelector=function(){var e=this[0];if(!e.tagName){return""}var t=$(e);var n=t.attr("id");if(n){return"#"+n}var r=t.attr("class");var i;if(r){i="."+$.trim(r).replace(/\s/gi,".")}var s;var o=t.parent();var u=o.children();var a=false;if(i&&u.filter(i).length==1){s=i}else if(u.filter(e.tagName).length==1){s=e.tagName}else{s=":nth("+$(this).index()+")";a=true}if(!a){for(ancestor$=o.parent();ancestor$.length==1&&ancestor$.find(s).length==1;o=ancestor$,ancestor$=ancestor$.parent());if(ancestor$.length==0){return s}}return o.getSelector()+" > "+s}(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){e(require("jquery"))}else{e(jQuery)}}(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){if(e.indexOf('"')===0){e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{e=decodeURIComponent(e.replace(t," "));return u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g;var u=e.cookie=function(t,s,a){if(arguments.length>1&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires==="number"){var f=a.expires,l=a.expires=new Date;l.setTime(+l+f*864e5)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{};var h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("=");var m=r(v.shift());var g=v.join("=");if(t&&t===m){c=o(g,s);break}if(!t&&(g=o(g))!==undefined){c[m]=g}}return c};u.defaults={};e.removeCookie=function(t,n){if(e.cookie(t)===undefined){return false}e.cookie(t,"",e.extend({},n,{expires:-1}));return!e.cookie(t)}}));var SnailTracker=Object.create({api_key:null,api_url:null,url:function(e){return[this.api_url,e].join("/")},initialize:function(){var e=this;this.session.initialize(this);this.actions.initialize(this);$("body").on("click focus blur",function(t){e.actions.create(t,$(t.target))});$("body").on("change",":input",function(t){e.actions.create(t,$(t.target))})},cookies:{session:"snailtracker-session"}});SnailTracker.actions=Object.create({snailtracker:null,initialize:function(e){this.snailtracker=e},create:function(e,t){var n=t.getSelector();var r=e.type;var i=t.text();var s=this;var o={session_api_key:s.snailtracker.session.id,url:window.location.origin,keycode:e.keyCode,action_type_name:r,target_text:i,target_value:$(e.target).secure_val(),selector:n,"char":null};if($.inArray(e.type,["keyup","keydown"])){o.char=String.fromCharCode(e.which)}$.post(this.snailtracker.url("actions"),$.param({api_key:s.snailtracker.api_key,app_action:o}))}});SnailTracker.session=Object.create({snailtracker:null,id:null,create:function(){var e=this;$.post(this.snailtracker.url("sessions"),$.param({api_key:e.snailtracker.api_key,session:{user_id:e.snailtracker.user_id,user_name:e.snailtracker.user_name,email:e.snailtracker.email}}),function(t){e.id=t["session"]["api_key"];e.set_cookie()})},set_cookie:function(){$.cookie(this.snailtracker.cookies.session,this.id,{expires:1})},initialize:function(e){this.snailtracker=e;if($.cookie(this.snailtracker.cookies.session)){this.id=$.cookie(this.snailtracker.cookies.session);this.set_cookie()}else{this.create()}}});$.fn.secure_val=function(){var e="XXXXXX";var t=this.val();var n=t.replace(/[^0-9]/g,"");if(n.length>=12&&n.length<=20){return e}if(this.attr("type")=="password"){return e}return t}
